{
  "__inputs": [
    {
      "name": "DS_PROMETHEUS",
      "label": "Prometheus",
      "description": "Prometheus data source for Arabica metrics",
      "type": "datasource",
      "pluginId": "prometheus",
      "pluginName": "Prometheus"
    }
  ],
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": { "type": "grafana", "uid": "-- Grafana --" },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": null,
  "links": [],
  "panels": [
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "id": 100,
      "title": "Overview",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "steps": [{ "color": "green", "value": null }] }
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 0, "y": 1 },
      "id": 1,
      "options": { "colorMode": "background", "graphMode": "area", "reduceOptions": { "calcs": ["lastNotNull"] } },
      "title": "Request Rate",
      "type": "stat",
      "targets": [
        {
          "expr": "sum(rate(arabica_http_requests_total[5m]))",
          "legendFormat": "req/s",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "steps": [{ "color": "green", "value": null }, { "color": "red", "value": 0.01 }] },
          "unit": "percentunit"
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 4, "y": 1 },
      "id": 2,
      "options": { "colorMode": "background", "graphMode": "area", "reduceOptions": { "calcs": ["lastNotNull"] } },
      "title": "Error Rate (5xx)",
      "type": "stat",
      "targets": [
        {
          "expr": "sum(rate(arabica_http_requests_total{status=~\"5..\"}[5m])) / sum(rate(arabica_http_requests_total[5m]))",
          "legendFormat": "",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 0.25 }, { "color": "red", "value": 1 }] },
          "unit": "s"
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 8, "y": 1 },
      "id": 3,
      "options": { "colorMode": "background", "graphMode": "area", "reduceOptions": { "calcs": ["lastNotNull"] } },
      "title": "p95 Latency",
      "type": "stat",
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(arabica_http_request_duration_seconds_bucket[5m])) by (le))",
          "legendFormat": "",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "steps": [{ "color": "blue", "value": null }] }
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 12, "y": 1 },
      "id": 4,
      "options": { "colorMode": "background", "graphMode": "none", "reduceOptions": { "calcs": ["lastNotNull"] } },
      "title": "Firehose Connected",
      "type": "stat",
      "targets": [
        {
          "expr": "arabica_firehose_connection_state",
          "legendFormat": "",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "steps": [{ "color": "purple", "value": null }] }
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 16, "y": 1 },
      "id": 5,
      "options": { "colorMode": "background", "graphMode": "area", "reduceOptions": { "calcs": ["lastNotNull"] } },
      "title": "Firehose Events/s",
      "type": "stat",
      "targets": [
        {
          "expr": "sum(rate(arabica_firehose_events_total[5m]))",
          "legendFormat": "",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "steps": [{ "color": "green", "value": null }, { "color": "red", "value": 0.5 }] },
          "unit": "percentunit"
        }
      },
      "gridPos": { "h": 4, "w": 4, "x": 20, "y": 1 },
      "id": 6,
      "options": { "colorMode": "background", "graphMode": "area", "reduceOptions": { "calcs": ["lastNotNull"] } },
      "title": "Feed Cache Hit Rate",
      "type": "stat",
      "targets": [
        {
          "expr": "rate(arabica_feed_cache_hits_total[5m]) / (rate(arabica_feed_cache_hits_total[5m]) + rate(arabica_feed_cache_misses_total[5m]))",
          "legendFormat": "",
          "refId": "A"
        }
      ]
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 5 },
      "id": 101,
      "title": "HTTP Traffic",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 20, "lineWidth": 2, "stacking": { "mode": "normal" } }
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 6 },
      "id": 10,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "title": "Request Rate by Status",
      "type": "timeseries",
      "targets": [
        {
          "expr": "sum by (status) (rate(arabica_http_requests_total{status=~\"2..\"}[5m]))",
          "legendFormat": "2xx",
          "refId": "A"
        },
        {
          "expr": "sum by (status) (rate(arabica_http_requests_total{status=~\"3..\"}[5m]))",
          "legendFormat": "3xx",
          "refId": "B"
        },
        {
          "expr": "sum by (status) (rate(arabica_http_requests_total{status=~\"4..\"}[5m]))",
          "legendFormat": "4xx",
          "refId": "C"
        },
        {
          "expr": "sum by (status) (rate(arabica_http_requests_total{status=~\"5..\"}[5m]))",
          "legendFormat": "5xx",
          "refId": "D"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 20, "lineWidth": 2, "stacking": { "mode": "normal" } }
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 6 },
      "id": 11,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "title": "Request Rate by Path",
      "type": "timeseries",
      "targets": [
        {
          "expr": "sum by (path) (rate(arabica_http_requests_total{path!=\"/static/*\"}[5m])) > 0",
          "legendFormat": "{{path}}",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "s"
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 14 },
      "id": 12,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "title": "Request Latency Percentiles",
      "type": "timeseries",
      "targets": [
        {
          "expr": "histogram_quantile(0.50, sum(rate(arabica_http_request_duration_seconds_bucket{path!=\"/static/*\"}[5m])) by (le))",
          "legendFormat": "p50",
          "refId": "A"
        },
        {
          "expr": "histogram_quantile(0.95, sum(rate(arabica_http_request_duration_seconds_bucket{path!=\"/static/*\"}[5m])) by (le))",
          "legendFormat": "p95",
          "refId": "B"
        },
        {
          "expr": "histogram_quantile(0.99, sum(rate(arabica_http_request_duration_seconds_bucket{path!=\"/static/*\"}[5m])) by (le))",
          "legendFormat": "p99",
          "refId": "C"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "s"
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 14 },
      "id": 13,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "title": "Latency by Path (p95)",
      "type": "timeseries",
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum by (le, path) (rate(arabica_http_request_duration_seconds_bucket{path!=\"/static/*\"}[5m])))",
          "legendFormat": "{{path}}",
          "refId": "A"
        }
      ]
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 22 },
      "id": 102,
      "title": "Firehose",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 20, "lineWidth": 2, "stacking": { "mode": "normal" } }
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 23 },
      "id": 20,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "title": "Events by Collection",
      "type": "timeseries",
      "targets": [
        {
          "expr": "sum by (collection) (rate(arabica_firehose_events_total[5m]))",
          "legendFormat": "{{collection}}",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 20, "lineWidth": 2, "stacking": { "mode": "normal" } }
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 23 },
      "id": 21,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "title": "Events by Operation",
      "type": "timeseries",
      "targets": [
        {
          "expr": "sum by (operation) (rate(arabica_firehose_events_total[5m]))",
          "legendFormat": "{{operation}}",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "thresholds": { "steps": [{ "color": "green", "value": null }, { "color": "red", "value": 0.1 }] }
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 31 },
      "id": 22,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "title": "Firehose Error Rate",
      "type": "timeseries",
      "targets": [
        {
          "expr": "rate(arabica_firehose_errors_total[5m])",
          "legendFormat": "errors/s",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [
            { "options": { "0": { "color": "red", "text": "Disconnected" }, "1": { "color": "green", "text": "Connected" } }, "type": "value" }
          ],
          "thresholds": { "steps": [{ "color": "red", "value": null }, { "color": "green", "value": 1 }] }
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 31 },
      "id": 23,
      "options": { "colorMode": "background", "graphMode": "none", "reduceOptions": { "calcs": ["lastNotNull"] } },
      "title": "Connection State",
      "type": "stat"  ,
      "targets": [
        {
          "expr": "arabica_firehose_connection_state",
          "legendFormat": "",
          "refId": "A"
        }
      ]
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 39 },
      "id": 103,
      "title": "PDS / ATProto",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 20, "lineWidth": 2, "stacking": { "mode": "normal" } }
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 40 },
      "id": 30,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "title": "PDS Request Rate by Method",
      "type": "timeseries",
      "targets": [
        {
          "expr": "sum by (method) (rate(arabica_pds_requests_total[5m]))",
          "legendFormat": "{{method}}",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "s"
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 40 },
      "id": 31,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "title": "PDS Latency by Method (p95)",
      "type": "timeseries",
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum by (le, method) (rate(arabica_pds_request_duration_seconds_bucket[5m])))",
          "legendFormat": "{{method}}",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 20, "lineWidth": 2, "stacking": { "mode": "normal" } }
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 48 },
      "id": 32,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "title": "PDS Requests by Collection",
      "type": "timeseries",
      "targets": [
        {
          "expr": "sum by (collection) (rate(arabica_pds_requests_total[5m]))",
          "legendFormat": "{{collection}}",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "thresholds": { "steps": [{ "color": "green", "value": null }, { "color": "red", "value": 0.1 }] }
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 48 },
      "id": 33,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "title": "PDS Error Rate by Method",
      "type": "timeseries",
      "targets": [
        {
          "expr": "sum by (method) (rate(arabica_pds_errors_total[5m]))",
          "legendFormat": "{{method}}",
          "refId": "A"
        }
      ]
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 56 },
      "id": 104,
      "title": "Feed Cache",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 20, "lineWidth": 2 }
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 57 },
      "id": 40,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "title": "Feed Cache Hits vs Misses",
      "type": "timeseries",
      "targets": [
        {
          "expr": "rate(arabica_feed_cache_hits_total[5m])",
          "legendFormat": "hits",
          "refId": "A"
        },
        {
          "expr": "rate(arabica_feed_cache_misses_total[5m])",
          "legendFormat": "misses",
          "refId": "B"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "percentunit",
          "thresholds": { "steps": [{ "color": "red", "value": null }, { "color": "yellow", "value": 0.5 }, { "color": "green", "value": 0.8 }] }
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 57 },
      "id": 41,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "title": "Feed Cache Hit Rate",
      "type": "timeseries",
      "targets": [
        {
          "expr": "rate(arabica_feed_cache_hits_total[5m]) / (rate(arabica_feed_cache_hits_total[5m]) + rate(arabica_feed_cache_misses_total[5m]))",
          "legendFormat": "hit rate",
          "refId": "A"
        }
      ]
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 65 },
      "id": 105,
      "title": "Users",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "steps": [{ "color": "blue", "value": null }] }
        }
      },
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 66 },
      "id": 50,
      "options": { "colorMode": "background", "graphMode": "none", "reduceOptions": { "calcs": ["lastNotNull"] } },
      "title": "Known Users",
      "type": "stat",
      "targets": [
        {
          "expr": "arabica_known_users_total",
          "legendFormat": "",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "steps": [{ "color": "blue", "value": null }] }
        }
      },
      "gridPos": { "h": 4, "w": 6, "x": 6, "y": 66 },
      "id": 51,
      "options": { "colorMode": "background", "graphMode": "none", "reduceOptions": { "calcs": ["lastNotNull"] } },
      "title": "Registered Users",
      "type": "stat",
      "targets": [
        {
          "expr": "arabica_registered_users_total",
          "legendFormat": "",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 }
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 66 },
      "id": 52,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "title": "Login Rate",
      "type": "timeseries",
      "targets": [
        {
          "expr": "rate(arabica_auth_logins_total{status=\"success\"}[5m])",
          "legendFormat": "success",
          "refId": "A"
        },
        {
          "expr": "rate(arabica_auth_logins_total{status=\"failure\"}[5m])",
          "legendFormat": "failure",
          "refId": "B"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "steps": [{ "color": "blue", "value": null }] }
        }
      },
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 70 },
      "id": 53,
      "options": { "colorMode": "background", "graphMode": "none", "reduceOptions": { "calcs": ["lastNotNull"] } },
      "title": "Indexed Records",
      "type": "stat",
      "targets": [
        {
          "expr": "arabica_indexed_records_total",
          "legendFormat": "",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "bars", "fillOpacity": 80, "lineWidth": 1 }
        }
      },
      "gridPos": { "h": 4, "w": 6, "x": 6, "y": 70 },
      "id": 54,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "title": "Records by Collection",
      "type": "timeseries",
      "targets": [
        {
          "expr": "arabica_indexed_records_by_collection",
          "legendFormat": "{{collection}}",
          "refId": "A"
        }
      ]
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 74 },
      "id": 106,
      "title": "Engagement",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "steps": [{ "color": "purple", "value": null }] }
        }
      },
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 75 },
      "id": 60,
      "options": { "colorMode": "background", "graphMode": "none", "reduceOptions": { "calcs": ["lastNotNull"] } },
      "title": "Total Likes",
      "type": "stat",
      "targets": [
        {
          "expr": "arabica_indexed_likes_total",
          "legendFormat": "",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "steps": [{ "color": "purple", "value": null }] }
        }
      },
      "gridPos": { "h": 4, "w": 6, "x": 6, "y": 75 },
      "id": 61,
      "options": { "colorMode": "background", "graphMode": "none", "reduceOptions": { "calcs": ["lastNotNull"] } },
      "title": "Total Comments",
      "type": "stat",
      "targets": [
        {
          "expr": "arabica_indexed_comments_total",
          "legendFormat": "",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 20, "lineWidth": 2 }
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 75 },
      "id": 62,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "title": "Like & Comment Rate",
      "type": "timeseries",
      "targets": [
        {
          "expr": "sum by (operation) (rate(arabica_likes_total[5m]))",
          "legendFormat": "likes ({{operation}})",
          "refId": "A"
        },
        {
          "expr": "sum by (operation) (rate(arabica_comments_total[5m]))",
          "legendFormat": "comments ({{operation}})",
          "refId": "B"
        }
      ]
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 83 },
      "id": 107,
      "title": "Community",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "steps": [{ "color": "orange", "value": null }] }
        }
      },
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 84 },
      "id": 70,
      "options": { "colorMode": "background", "graphMode": "none", "reduceOptions": { "calcs": ["lastNotNull"] } },
      "title": "Pending Join Requests",
      "type": "stat",
      "targets": [
        {
          "expr": "arabica_join_requests_pending",
          "legendFormat": "",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 20, "lineWidth": 2 }
        }
      },
      "gridPos": { "h": 8, "w": 12, "x": 6, "y": 84 },
      "id": 71,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "title": "Join Requests & Invites Rate",
      "type": "timeseries",
      "targets": [
        {
          "expr": "rate(arabica_join_requests_total[5m])",
          "legendFormat": "join requests",
          "refId": "A"
        },
        {
          "expr": "rate(arabica_invites_created_total[5m])",
          "legendFormat": "invites sent",
          "refId": "B"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 }
        }
      },
      "gridPos": { "h": 8, "w": 6, "x": 18, "y": 84 },
      "id": 72,
      "options": { "legend": { "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
      "title": "Reports Rate",
      "type": "timeseries",
      "targets": [
        {
          "expr": "rate(arabica_reports_total[5m])",
          "legendFormat": "reports/s",
          "refId": "A"
        }
      ]
    }
  ],
  "schemaVersion": 39,
  "tags": ["arabica", "prometheus", "metrics"],
  "templating": { "list": [] },
  "time": { "from": "now-1h", "to": "now" },
  "timepicker": {},
  "timezone": "",
  "title": "Arabica - Prometheus Metrics",
  "uid": "arabica-prometheus",
  "version": 1
}
