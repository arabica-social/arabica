{"id":"01KGA7S43ENCHDZQ9DXPGEA6W1","title":"Consolidate three modal systems into one","description":"CRITICAL: Consolidate three different modal implementations:\n- entity_modals.templ (Alpine.js x-show)\n- dialog_modals.templ (native HTML5 \u003cdialog\u003e)\n- profile.templ (inline Alpine modals)\n\nRecommendation: Migrate all to native \u003cdialog\u003e for modern standard and better a11y.\nRemove Alpine.js modal code and inline modal implementations.\n\nAcceptance criteria:\n- All modals use consistent implementation\n- Better accessibility\n- Reduced maintenance burden","status":"completed","priority":"high","assignee":"patrick","change_id":"zvoovqqnlutxuzrwzpslzvxvsokyvyux","labels":["frontend","refactor","modals"],"created_at":"2026-01-31T14:37:13.710608293Z","updated_at":"2026-01-31T15:07:11.640016975Z","completed_at":"2026-01-31T15:07:11.609500036Z"}
{"id":"01KGA7SZW8TPBWJZ40DHFC9RSF","title":"Fix modal fade-out animations","description":"Modals don't fade out on save/cancel as expected. They should smoothly transition out.\n\nAcceptance criteria:\n- Modals fade out smoothly when closed\n- Consistent animation timing\n- Works for both save and cancel actions","status":"completed","priority":"normal","labels":["frontend","modals","ux"],"created_at":"2026-01-31T14:37:42.152625516Z","updated_at":"2026-01-31T22:01:05.514388522Z","completed_at":"2026-01-31T22:01:05.499540746Z"}
{"id":"01KGA7SZY65S5V97C7B3PKA172","title":"Fix feed view details button","description":"Feed item 'view details' button should be removed. The 'new brew' text in 'added a new brew' should link to view page instead (underline this text).\n\nAcceptance criteria:\n- Remove 'view details' button\n- Make 'new brew' text clickable and underlined\n- Links to correct brew view page","status":"completed","priority":"normal","labels":["frontend","feed","ux"],"created_at":"2026-01-31T14:37:42.214656646Z","updated_at":"2026-01-31T16:28:52.517267974Z","completed_at":"2026-01-31T16:28:52.506611951Z"}
{"id":"01KGA7T004T9HZR1Q5MHSC48G6","title":"Fix manage page notes truncation","description":"Manage brews page truncates notes unnecessarily, while variables wrap to many more lines.\n\nAcceptance criteria:\n- Notes should not be truncated (or have higher character limit)\n- Consistent text wrapping behavior\n- Better readability","status":"completed","priority":"low","labels":["frontend","manage","ux"],"created_at":"2026-01-31T14:37:42.276141862Z","updated_at":"2026-01-31T21:36:44.490824871Z","completed_at":"2026-01-31T21:36:44.478912822Z"}
{"id":"01KGA7T026JJ8H9EK24K17QRA4","title":"Improve loading UX with progress bars or transitions","description":"Loading on HTMX could be snappier with loading bars or transitionary animations.\n\nOptions:\n- Loading bar waiting until everything is loaded\n- Transitionary animations between skeleton and full loads\n- Reconsider if skeleton loading is needed with SSR (probably yes due to PDS data fetches)\n\nAcceptance criteria:\n- Smoother loading experience\n- No jarring transitions\n- Consistent loading indicators","status":"open","priority":"normal","labels":["frontend","ux","htmx"],"created_at":"2026-01-31T14:37:42.342432216Z","updated_at":"2026-01-31T14:37:42.342432216Z"}
{"id":"01KGA7T04HWD93MJQDKZ62XQNB","title":"Fix skeleton headers to match actual table headers","description":"Headers in loading skeletons need to exactly match final table headers.\n\nCurrent issue:\n- Profile refresh shows brew headers for all tabs\n- Inconsistent column counts (brew_list: 6 cols, profile: 5 cols, manage: 5 cols)\n\nAcceptance criteria:\n- Skeleton headers match actual content headers\n- Tab-specific skeletons or dynamic skeletons based on active tab\n- Consistent column structure","status":"open","priority":"normal","labels":["frontend","ux","skeleton"],"created_at":"2026-01-31T14:37:42.417653543Z","updated_at":"2026-01-31T14:37:42.417653543Z"}
{"id":"01KGA7T06FC5V4Z92570G0BY5G","title":"Style mail link and back button on terms page","description":"Add proper styling to mail link and 'back to home' button on terms page.\n\nAcceptance criteria:\n- Consistent button/link styling\n- Matches site design system\n- Good visual hierarchy","status":"completed","priority":"low","assignee":"patrick","change_id":"znoumknmuoxkwwrrzrlvtonksrokkvnu","labels":["frontend","styling"],"created_at":"2026-01-31T14:37:42.479212418Z","updated_at":"2026-02-01T00:25:41.74512756Z","completed_at":"2026-02-01T00:25:41.714091178Z"}
{"id":"01KGA7T08BAWPB977KSHZNS8NE","title":"Revision pass on about and terms text","description":"Review and revise text content in about and terms pages for clarity and accuracy.\n\nAcceptance criteria:\n- Clear, concise messaging\n- No typos or grammar issues\n- Accurate information","status":"claimed","priority":"low","assignee":"patrick","labels":["content","documentation"],"created_at":"2026-01-31T14:37:42.539757583Z","updated_at":"2026-01-31T15:30:48.329882372Z"}
{"id":"01KGA7T0AE0R3F8PRHX761W03E","title":"Implement profile picture caching in database","description":"Cache profile pictures to database to avoid reloading them frequently. This may already be partially implemented - needs investigation.\n\nAcceptance criteria:\n- Profile pictures cached in database\n- Reduced PDS API calls for avatar fetching\n- Cache invalidation strategy\n- Performance improvement","status":"open","priority":"high","labels":["backend","performance","caching"],"created_at":"2026-01-31T14:37:42.606749189Z","updated_at":"2026-01-31T14:37:42.606749189Z"}
{"id":"01KGA7T0CRPVYSNS9FHE13NMQC","title":"Fix double page transition on back navigation","description":"Hitting back from /brews/new to home page shows welcome box, then transitions in - looks bad.\n\nIssue: Transition seems to trigger twice\nRoot cause: Transition code may be brittle\n\nAcceptance criteria:\n- Single smooth transition on back navigation\n- No double-rendering of welcome box\n- Consider refactoring transition code to be less brittle","status":"completed","priority":"normal","labels":["frontend","navigation","transitions"],"created_at":"2026-01-31T14:37:42.680660721Z","updated_at":"2026-01-31T21:37:20.31354036Z","completed_at":"2026-01-31T21:37:20.300721855Z"}
{"id":"01KGA7TZ6365GY1YG55BGYVKMH","title":"Fix non-functional back button on view page","description":"Back button on brew view page does nothing and produces no logs.\n\nAcceptance criteria:\n- Back button navigates to previous page\n- Proper navigation behavior\n- Debug logging if needed","status":"completed","priority":"normal","labels":["frontend","navigation","bug"],"created_at":"2026-01-31T14:38:14.211441899Z","updated_at":"2026-01-31T20:23:51.90297311Z","completed_at":"2026-01-31T20:23:51.889306189Z"}
{"id":"01KGA7TZ94GDGY53NFXW1K7K6Y","title":"Fix modal record creation not updating list","description":"Adding a record from a modal in brews page doesn't update the list until page refresh.\n\nOlder version on main branch had correct behavior: adds to list and auto-selects.\n\nAcceptance criteria:\n- New records appear in list immediately after creation\n- Auto-select newly created record\n- No page refresh needed","status":"completed","priority":"high","change_id":"kkktpzkmkwuwwrqoptsyoyuuwvqwwwrz","workspace_path":"/home/patrick/projects/arabica/.worktrees/cell-01KGA7TZ94GD","labels":["frontend","htmx","modals","bug"],"created_at":"2026-01-31T14:38:14.308945383Z","updated_at":"2026-01-31T15:55:09.476557868Z","completed_at":"2026-01-31T15:55:09.462025879Z"}
{"id":"01KGA7TZBJ5KYR9HVS57SY5CBD","title":"Reduce table flash on page load","description":"Tables flash briefly on load. Could load more smoothly, perhaps by delaying page until skeleton is rendered.\n\nProfile page does this well with profile banner and stats.\n\nAcceptance criteria:\n- Smoother table loading\n- No visible flash/jump\n- Better perceived performance","status":"completed","priority":"low","change_id":"opplvnrzuswososkrrsrurokmlltszwn","labels":["frontend","ux","performance"],"created_at":"2026-01-31T14:38:14.386960128Z","updated_at":"2026-01-31T16:27:23.272054602Z","completed_at":"2026-01-31T16:27:23.246146545Z"}
{"id":"01KGA7TZE5PE47X9JTQ85ZZJM4","title":"Refactor web code into organized subdirectory","description":"Move all frontend code into web subdirectory within internal.\n\nCurrent structure needs organization:\n- Move components and pages into separate dirs\n- Target: internal/web/components, internal/web/pages\n- bff directory should also move to internal/web/bff\n\nAcceptance criteria:\n- Clean directory structure\n- All imports updated\n- Tests still pass\n- No broken references","status":"completed","priority":"normal","labels":["refactor","structure"],"created_at":"2026-01-31T14:38:14.469128797Z","updated_at":"2026-01-31T21:41:04.12120685Z","completed_at":"2026-01-31T21:41:04.109407281Z"}
{"id":"01KGA7TZG6AP8FJJTW5GAA60X5","title":"Evaluate merging manage and profile pages","description":"Consider if manage, profile, and brew list should be separate pages.\n\nOptions:\n- Merge manage and profile\n- Merge brew list and manage\n- Keep separate\n\nNeeds design decision before implementation.\n\nAcceptance criteria:\n- Evaluate user flow and UX\n- Document decision rationale\n- Implementation plan if merge is chosen","status":"open","priority":"low","labels":["design","ux","frontend"],"created_at":"2026-01-31T14:38:14.534537889Z","updated_at":"2026-01-31T14:38:14.534537889Z"}
{"id":"01KGA7TZJDMR7DWT1M0MAKP6NR","title":"Standardize edit/delete buttons on profile tables","description":"Profile tables are inconsistent - some have edit/delete buttons, others don't.\n\nAlso consider adding buttons below each table for that record type.\n\nAcceptance criteria:\n- All tables have consistent button placement\n- Either all have edit/delete or none do\n- Add buttons below tables for adding new records\n- Consistent UX across all tables","status":"completed","priority":"normal","labels":["frontend","ux","consistency"],"created_at":"2026-01-31T14:38:14.605304682Z","updated_at":"2026-01-31T22:23:51.571545748Z","completed_at":"2026-01-31T22:23:51.559620864Z"}
{"id":"01KGA7TZMPFGZH6R6ZMASAD2GE","title":"Design nested modal system for entity creation","description":"Enable creating related entities from within modals (e.g., create roaster from within bean modal).\n\nDesign idea:\n- Transition that moves first modal left\n- Opens second modal to the right\n- Smooth nested flow\n\nAcceptance criteria:\n- Design nested modal UX\n- Smooth transitions\n- Good visual hierarchy\n- Can return to parent modal\n- Data flows correctly between modals","status":"blocked","priority":"low","blocked_by":["01KGA7S43ENCHDZQ9DXPGEA6W1"],"labels":["design","ux","modals","future"],"created_at":"2026-01-31T14:38:14.678025134Z","updated_at":"2026-01-31T14:38:59.768553798Z"}
{"id":"01KGA7TZPQPY2JC3HFPVPKHNBQ","title":"Refactor forms to use form components","description":"Form components in forms.templ are defined but rarely used (only in brew_form.templ).\nModals and other forms use inline HTML instead.\n\nComponents available:\n- TextInput\n- NumberInput\n- TextArea\n- Select\n- FormField\n\nAcceptance criteria:\n- All forms use form components\n- Remove inline form HTML\n- Consistent form styling\n- Better maintainability","status":"completed","priority":"normal","assignee":"patrick","change_id":"rlzoowttmqxrqwlmpkottlurxzsxslyu","labels":["refactor","frontend","forms"],"created_at":"2026-01-31T14:38:14.743183429Z","updated_at":"2026-01-31T14:58:58.965241694Z","completed_at":"2026-01-31T14:58:58.924457633Z"}
{"id":"01KGA7TZRHNG2AVHBT91NJY4KD","title":"Replace inline card classes with Card component","description":"card.templ defines Card component but many places use inline card classes instead.\n\nAcceptance criteria:\n- All card-style elements use Card component\n- Remove inline card class usage\n- Consistent card styling\n- Component-based approach","status":"completed","priority":"low","assignee":"patrick","change_id":"yokzvvstynposzwsznxpqptwstqrxzqu","labels":["refactor","frontend","components"],"created_at":"2026-01-31T14:38:14.801428078Z","updated_at":"2026-02-01T00:25:45.227470232Z","completed_at":"2026-02-01T00:25:45.186028348Z"}
{"id":"01KGA7TZTT05WWENTHR41X4RQH","title":"Replace inline buttons with button components","description":"buttons.templ defines PrimaryButton/SecondaryButton but they're rarely used.\nMost places use inline button classes.\n\nAcceptance criteria:\n- All buttons use button components\n- Remove inline button class usage\n- Consistent button styling\n- Component-based approach","status":"open","priority":"low","labels":["refactor","frontend","components"],"created_at":"2026-01-31T14:38:14.874329448Z","updated_at":"2026-01-31T14:38:14.874329448Z"}
{"id":"01KGA7VXDTVY5W11QJ1VPZ5M3Y","title":"Implement settings menu","description":"Create settings menu with the following features:\n\n1. Private mode - Don't show in community feed (records still public via PDS API)\n2. Dev mode - Show DID, copy DID in profiles (remove 'logged in as \u003cdid\u003e' from home)\n3. Toggle for table view vs future post-style view\n\nAcceptance criteria:\n- Settings page/modal created\n- All three settings implemented\n- Settings persisted per user\n- UI updated based on settings","status":"blocked","priority":"normal","blocked_by":["01KGA7VXFQABCAQV83A6C49WEY"],"labels":["feature","frontend","settings"],"created_at":"2026-01-31T14:38:45.178941765Z","updated_at":"2026-01-31T14:39:00.016324424Z"}
{"id":"01KGA7VXFQABCAQV83A6C49WEY","title":"Design post-style record view (mobile-friendly)","description":"LARGE FEATURE: Complete record styling refactor from table-style to mobile-friendly post-style.\n\nSimilar to Bluesky posts format.\nShould include setting to use legacy table view.\n\nThis is a major redesign - to be done later down the line.\n\nAcceptance criteria:\n- Design post-style layout\n- Mobile-friendly and responsive\n- Legacy table view option\n- Smooth migration path\n- Better UX on mobile devices","status":"open","priority":"low","labels":["feature","design","frontend","mobile","future"],"created_at":"2026-01-31T14:38:45.23927703Z","updated_at":"2026-01-31T14:38:45.23927703Z"}
{"id":"01KGA7VXHR31MSHEKH91C41TYM","title":"Add loading progress bars to page navigation","description":"Consider adding loading bars to page loads (above header perhaps).\n\nSeparate nicer/prettier loading bar would also be nice on brews page.\n\nAcceptance criteria:\n- Loading bar visible during page navigation\n- Positioned appropriately (above header)\n- Smooth animations\n- Better perceived performance","status":"open","priority":"low","labels":["feature","frontend","ux"],"created_at":"2026-01-31T14:38:45.304772299Z","updated_at":"2026-01-31T14:38:45.304772299Z"}
{"id":"01KGA7VXM0F3A1R10BC3V29A0Y","title":"Verify context flows through all methods","description":"From CLAUDE.md Known Issues: Context should flow through methods (some fixed, verify all paths).\n\nAudit codebase to ensure context.Context is properly passed through all method chains.\n\nAcceptance criteria:\n- All methods accept and use context\n- No context.Background() in handlers\n- Context cancellation works correctly\n- Request timeouts respected","status":"open","priority":"high","labels":["backend","refactor","correctness"],"created_at":"2026-01-31T14:38:45.376033105Z","updated_at":"2026-01-31T14:38:45.376033105Z"}
{"id":"01KGA7VXP6P4SMB1MTYFFM3WZH","title":"Fix cache race conditions with copy-on-write","description":"From CLAUDE.md Known Issues: Cache race conditions need copy-on-write pattern.\n\nCurrent caching implementation may have race conditions.\n\nAcceptance criteria:\n- Implement copy-on-write pattern\n- No data races (verified with -race flag)\n- Thread-safe cache operations\n- Performance maintained or improved","status":"open","priority":"high","labels":["backend","concurrency","bug","cache"],"created_at":"2026-01-31T14:38:45.446031585Z","updated_at":"2026-01-31T14:38:45.446031585Z"}
{"id":"01KGA7VXR4EVGR470P4M9JH80C","title":"Add CID validation on record updates","description":"From CLAUDE.md Known Issues: Missing CID validation on record updates (AT Protocol best practice).\n\nImplement CID (Content Identifier) validation when updating records to ensure record hasn't changed.\n\nAcceptance criteria:\n- CID validation on all record updates\n- Proper error handling for CID mismatches\n- Follows AT Protocol best practices\n- Tests covering CID validation","status":"open","priority":"normal","labels":["backend","atproto","validation"],"created_at":"2026-01-31T14:38:45.508526626Z","updated_at":"2026-01-31T14:38:45.508526626Z"}
{"id":"01KGA7VXT4S4VGYZ2FDE1RR2XX","title":"Implement rate limiting for PDS calls","description":"From CLAUDE.md Known Issues: Rate limiting for PDS calls not implemented.\n\nAdd rate limiting to prevent excessive API calls to PDS servers.\n\nAcceptance criteria:\n- Rate limiting implemented for PDS API calls\n- Configurable limits\n- Proper error handling when rate limited\n- Backoff strategy\n- Monitoring/logging of rate limit hits","status":"open","priority":"high","labels":["backend","performance","atproto"],"created_at":"2026-01-31T14:38:45.572884867Z","updated_at":"2026-01-31T14:38:45.572884867Z"}
{"id":"01KGA7VXVZQBMZX6RVG3B49TYW","title":"Consider migration from BoltDB to SQLite","description":"Far future consideration: Maybe swap from BoltDB to SQLite using non-cgo library.\n\nThis is exploratory - need to evaluate:\n- Benefits of SQLite vs BoltDB\n- Migration effort\n- Performance impact\n- Query capabilities\n\nAcceptance criteria:\n- Evaluate pros/cons\n- Document decision\n- If proceeding: migration plan and implementation","status":"claimed","priority":"low","assignee":"patrick","labels":["backend","database","future","evaluation"],"created_at":"2026-01-31T14:38:45.631852717Z","updated_at":"2026-01-31T15:31:07.948160371Z"}
{"id":"01KGACBM7JBN0G9R5PYXEPCFXS","title":"Fix manage page table refresh after modal operations","description":"The manage page tables don't refresh when entities are created, updated, or deleted via modals. The entity managers and entity-helpers already try to trigger refreshes but the HTMX element only responds to initial page load.","status":"completed","priority":"normal","assignee":"patrick","created_at":"2026-01-31T15:57:14.354187839Z","updated_at":"2026-01-31T16:08:49.974241439Z","completed_at":"2026-01-31T15:58:50.307512595Z","notes":[{"timestamp":"2026-01-31T15:57:40.913521034Z","author":"patrick","message":"## Problem\nThe entity managers (in manage-page.js) and entity-helpers.js already try to trigger refreshes by calling:\n  htmx.trigger(manageLoader, 'load')\n\nHowever, the HTMX element in manage.templ (line 64) has:\n  hx-trigger=\"load\"\n\nThis only responds to the initial page load event, not subsequent programmatic 'load' triggers.\n\n## Requirements\n1. Modify the HTMX trigger in manage.templ to respond to a custom refresh event\n2. Update manage-page.js entity manager onSuccess callbacks to dispatch the custom event\n3. Update entity-helpers.js refreshEntityDropdown to dispatch the custom event\n4. Ensure both creates and deletes trigger the refresh\n5. Test all CRUD operations for all entity types (beans, roasters, grinders, brewers)\n\n## Implementation Approach\n1. Add custom event listener to hx-trigger (e.g., 'load, refreshManage from:body')\n2. Dispatch 'refreshManage' event instead of/in addition to triggering 'load'\n3. Verify the event bubbles up to trigger the HTMX reload\n\n## Files to Modify\n- internal/web/pages/manage.templ (HTMX trigger)\n- web/static/js/manage-page.js (entity manager onSuccess callbacks)\n- web/static/js/entity-helpers.js (refreshEntityDropdown function)\n\n## Success Criteria\n- Creating an entity via modal immediately shows it in the table\n- Updating an entity via modal immediately shows changes in the table\n- Deleting an entity immediately removes it from the table\n- Works for all four entity types (beans, roasters, grinders, brewers)"},{"timestamp":"2026-01-31T15:58:47.084907175Z","author":"patrick","message":"## Implementation Complete\n\nModified three files to fix table refresh:\n\n1. **internal/web/pages/manage.templ**\n   - Updated hx-trigger to: 'load, refreshManage from:body'\n   - Now responds to both initial page load AND custom refresh events\n\n2. **web/static/js/manage-page.js**\n   - Updated all 4 entity manager onSuccess callbacks\n   - Now dispatches 'refreshManage' CustomEvent on document.body\n\n3. **web/static/js/entity-helpers.js**\n   - Updated refreshEntityDropdown function\n   - Dispatches 'refreshManage' event when on manage page\n\nThe custom event approach is cleaner than triggering 'load' programmatically and ensures proper event bubbling for HTMX to catch."},{"timestamp":"2026-01-31T16:00:19.33430635Z","author":"patrick","message":"## Bug Fix: Delete not refreshing table\n\nFound that the delete() method in entity-manager.js wasn't calling the onSuccess callback, while save() was.\n\n**Modified:** web/static/js/entity-manager.js (lines 154-162)\n- Added onSuccess callback invocation after cache invalidation in delete method\n- Now both save() and delete() trigger the refreshManage event\n- Delete operations will now properly refresh the manage page tables"},{"timestamp":"2026-01-31T16:02:50.833338786Z","author":"patrick","message":"## Additional fix for delete refresh\n\nThe onSuccess callback approach wasn't sufficient for deletes. Added explicit event dispatching:\n\n**Modified files:**\n1. web/static/js/entity-manager.js\n   - delete() method now returns boolean (true if successful, false if cancelled/failed)\n   \n2. web/static/js/manage-page.js  \n   - All delete methods now check return value and dispatch refreshManage only on success\n   - Prevents refresh if user cancels the confirmation dialog\n\n**Flow:**\n1. User clicks Delete → Alpine.js calls deleteBean/deleteRoaster/etc\n2. Entity manager shows confirmation dialog\n3. If cancelled: return false, no refresh\n4. If confirmed: DELETE request → return true\n5. manage-page.js receives true → dispatches refreshManage event\n6. HTMX hears event → reloads table\n\nThis is more reliable than relying solely on the onSuccess callback."},{"timestamp":"2026-01-31T16:08:49.961660711Z","author":"patrick","message":"## SOLUTION: Converted delete to use HTMX instead of Alpine.js\n\nThe root issue was mixing patterns - Edit used HTMX but Delete used Alpine.js + JavaScript fetch. This created inconsistency and timing issues.\n\n**Changed:** internal/web/components/manage_partial.templ\n- All delete buttons now use HTMX attributes instead of @click\n- hx-delete=\"/api/beans/{rkey}\" - sends DELETE request\n- hx-confirm=\"Are you sure...\" - built-in confirmation dialog\n- hx-target=\"closest tr\" - targets the parent table row\n- hx-swap=\"outerHTML swap:0.5s\" - removes row with fade animation\n\n**How it works:**\n1. User clicks Delete\n2. HTMX shows confirmation dialog\n3. If confirmed, sends DELETE to /api/beans/{rkey}\n4. Server deletes and returns 200 OK (empty body)\n5. HTMX swaps the table row's outerHTML with empty response\n6. Row instantly vanishes with 0.5s fade effect\n\n**Benefits:**\n- Immediate visual feedback (no full table reload needed)\n- Consistent with Edit button pattern\n- Simpler than JavaScript approach\n- Row-level granularity (only removes what was deleted)\n- No Alpine.js/HTMX coordination issues\n\n**Note:** The delete methods in manage-page.js are now unused and could be cleaned up in a future refactor."}]}
{"id":"01KGAEB648HERFCPSKW446H8SE","title":"Add closed/open status for coffee bean bags","description":"Add a boolean 'closed' field to the bean lexicon. Update UI to:\n1. Filter closed bags from brew dropdown\n2. Show open bags table at top of profile page\n3. Show closed bags table below roasters on profile page\n4. Show all bags in manage page with newest first, adding an 'open' column\n\nChanges needed:\n- Update lexicons/social.arabica.alpha.bean.json\n- Update internal/atproto/records.go for Bean model\n- Update internal/models/models.go\n- Update brew form dropdown to filter closed beans\n- Update profile page layout with separate tables\n- Update manage page table with open/closed column","status":"completed","priority":"high","assignee":"patrick","created_at":"2026-01-31T16:31:57.0649568Z","updated_at":"2026-01-31T16:55:24.596373389Z","completed_at":"2026-01-31T16:43:26.855808963Z","notes":[{"timestamp":"2026-01-31T16:43:26.748989495Z","author":"patrick","message":"Successfully implemented closed bag feature:\n- Added 'closed' boolean field to bean lexicon\n- Updated Bean model and request structs\n- Updated record conversion functions\n- Filtered closed bags from brew form dropdown\n- Split beans table on profile page into open bags (top) and closed bags (below roasters)\n- Added Status column to manage page beans table with Open/Closed badges\n- Added checkbox to bean form modals for marking bags as closed\n- Updated form handlers to parse closed field\nAll changes tested and verified to compile successfully."},{"timestamp":"2026-01-31T16:50:21.14203731Z","author":"patrick","message":"Fixed bean editing/closing issue:\n- Removed method='dialog' from all entity form dialogs (bean, roaster, grinder, brewer)\n- Added HTMX event handler to close dialog after successful submission\n- Added 'closed: false' to beanManager defaultFormData in manage-page.js\n- Updated editBean() to accept and pass closed parameter\n- Forms now properly submit via HTMX before closing\n- The 'closed' checkbox value is now correctly saved to PDS"},{"timestamp":"2026-01-31T16:55:24.581637936Z","author":"patrick","message":"Additional debugging and fixes:\n- Added explicit hx-trigger='submit' to all dialog forms to ensure HTMX intercepts form submission\n- Changed Alpine.js @ syntax to hx-on:: syntax for HTMX event handlers for better compatibility\n- Added explicit value='true' to closed checkbox for clearer form data\n- Updated handlers to check for 'true' instead of 'on' for closed field\n- Added debug logging to show what values are being received in handlers\n\nPlease test again and check server logs for debug output showing the closed_value and closed_parsed fields."}]}
{"id":"01KGAW0BCP3ZN415GBW40JFYST","title":"Use consistent default profile picture across profile and feed pages","description":"The default avatar fallback on the profile page uses bg-brown-300 (lighter brown) for large size, while the feed uses bg-brown-600 (darker brown) for medium size. This creates visual inconsistency. Update the Avatar component to use the same background color (bg-brown-300) for all sizes to maintain consistency across the app.","status":"completed","priority":"normal","assignee":"patrick","created_at":"2026-01-31T20:30:42.070239386Z","updated_at":"2026-01-31T20:32:38.61578807Z","completed_at":"2026-01-31T20:32:38.60500932Z"}
{"id":"01KGAW9PRR6X6WHKCZVKY2KQBH","title":"Add hover effect to profile avatars","description":"Add visual hover effects to profile avatars throughout the app (feed, header, profile pages). The effect should provide visual feedback when users hover over clickable profile pictures. Consider adding a subtle scale transform, glow effect, or ring color change to indicate interactivity.","status":"completed","priority":"normal","assignee":"patrick","created_at":"2026-01-31T20:35:48.632605618Z","updated_at":"2026-01-31T21:13:34.89255148Z","completed_at":"2026-01-31T20:37:03.856961732Z","notes":[{"timestamp":"2026-01-31T20:37:00.955611391Z","author":"patrick","message":"## Hover Effects Added\n\nUpdated the Avatar component in internal/web/components/shared.templ to add interactive hover effects:\n\n**For image avatars (all sizes):**\n- transition-all duration-200 - Smooth transitions for all properties\n- hover:ring-amber-400 - Ring color changes to amber on hover\n- hover:ring-4 - Ring grows thicker on hover (from ring-2 to ring-4)\n- hover:scale-110 (sm/md) - Avatar scales to 110% on hover\n- hover:scale-105 (lg) - Large avatars scale to 105% (subtler)\n\n**For fallback avatars (initials):**\n- Same transition and ring effects for sm/md sizes\n- hover:bg-brown-400 for large size (background darkens slightly)\n- hover:scale-110 (sm/md) and hover:scale-105 (lg)\n\n**Also fixed:**\n- Updated fallback avatar ring color from ring-brown-600 to ring-brown-500 for consistency with image avatars\n\n**Effect:**\n- Avatars in the feed, header, and profile pages now have smooth, visually appealing hover effects\n- The amber ring glow provides clear visual feedback that the avatar is clickable\n- Scale transform adds a subtle \"lift\" effect that feels responsive\n- 200ms duration provides smooth transitions without lag"},{"timestamp":"2026-01-31T21:13:34.87780839Z","author":"patrick","message":"## Final Implementation\n\nUpdated avatar hover effects based on feedback:\n\n**Changes:**\n1. Changed hover ring color from amber-400 (yellow) to brown-400 (more brown tone)\n2. Removed all scale transforms - avatars stay the same size on hover\n3. Only the ring/border changes color and thickness\n\n**Hover Effects (all sizes):**\n- transition-all duration-200 - Smooth 200ms transitions\n- hover:ring-brown-400 (sm/md) - Ring color changes to lighter brown\n- hover:border-brown-400 (lg) - Border color changes to lighter brown  \n- hover:ring-4 / hover:border-4 - Ring/border grows from 2px to 4px thickness\n- hover:bg-brown-400 (lg fallback only) - Background darkens slightly\n\n**Result:**\n- Subtle, elegant hover effect that doesn't distort the avatar\n- Brown color palette stays consistent with the app theme\n- Clear visual feedback that avatars are clickable\n- Works across feed, header, and profile pages"}]}
{"id":"01KGAYXQVTNKFSNEBYZHV0XVPG","title":"Remove unused Go functions in atproto package","description":"Several exported functions in the atproto package are completely unused:\n\n1. ResolveBeanRef() - internal/atproto/resolver.go:78\n   - Wrapper for resolveRef() that's never called\n   - ResolveBeanRefWithRoaster() is used instead\n\n2. GetSessionDataFromContext() - internal/atproto/oauth.go:203\n   - Leftover from refactoring, never called\n\n3. RequireAuth() - internal/atproto/oauth.go:212\n   - Alternative auth middleware that's never registered\n\n4. Commented-out fetchAllData() - internal/handlers/handlers.go:1530-1564\n   - Replaced by inline errgroup usage\n\nAdditionally verify if these are truly unused:\n- DeleteAuthRequestInfo() in boltstore/session_store.go\n- DeleteAllSessionsForDID() in boltstore/session_store.go\n\nAcceptance criteria:\n- Remove all confirmed dead code\n- Verify no external usage exists\n- Run tests to confirm nothing breaks","status":"completed","priority":"high","created_at":"2026-01-31T21:21:42.26644177Z","updated_at":"2026-01-31T21:28:01.229416423Z","completed_at":"2026-01-31T21:28:01.218546904Z","notes":[{"timestamp":"2026-01-31T21:27:57.208998517Z","author":"patrick","message":"Successfully removed unused Go functions:\n\nREMOVED:\n1. ResolveBeanRef() from internal/atproto/resolver.go:78 - Confirmed unused, only ResolveBeanRefWithRoaster() is used\n2. GetSessionDataFromContext() from internal/atproto/oauth.go:203 - Confirmed unused\n3. RequireAuth() from internal/atproto/oauth.go:212 - Confirmed unused middleware\n4. DeleteAllSessionsForDID() from internal/database/boltstore/session_store.go:168 - Confirmed unused\n\nRETAINED:\n- DeleteAuthRequestInfo() in boltstore/session_store.go - Required by oauth.ClientAuthStore interface, cannot be removed\n\nNOT FOUND:\n- Commented-out fetchAllData() in handlers.go - Already removed in previous cleanup\n\nVERIFICATION:\n- Searched codebase to confirm no usage of removed functions\n- go build completes without errors\n- All tests pass (go test ./...)"}]}
{"id":"01KGAYXQY6N1RPV042XF9907N6","title":"Refactor entity CRUD handlers to reduce duplication","description":"The handlers.go file contains significant code duplication across entity CRUD operations:\n\n**Create handlers (4 nearly identical):**\n- HandleBeanCreate (lines 897-960)\n- HandleRoasterCreate (lines 963-1011)\n- HandleGrinderCreate (lines 1223-1272)\n- HandleBrewerCreate (lines 1359-1407)\n\n**Update handlers (4 nearly identical):**\n- HandleBeanUpdate (lines 1039-1114)\n- HandleRoasterUpdate (lines 1139-1198)\n- HandleGrinderUpdate (lines 1274-1334)\n- HandleBrewerUpdate (lines 1409-1468)\n\nEach follows the exact same pattern:\n1. Check authentication\n2. Parse Content-Type (JSON vs form)\n3. Decode request body\n4. Validate request\n5. Call store method\n6. Encode JSON response\n\n**Proposed refactoring:**\nCreate a generic handler factory or helper that accepts:\n- Request type struct\n- Entity type/NSID\n- Form field mapping\n- Store method reference\n\nThis could reduce 500+ lines of repetitive code.\n\nAcceptance criteria:\n- Extract common logic into reusable functions\n- Reduce total lines by at least 300\n- Maintain all existing functionality\n- All tests pass","status":"completed","priority":"normal","created_at":"2026-01-31T21:21:42.342615886Z","updated_at":"2026-01-31T21:28:10.769242471Z","completed_at":"2026-01-31T21:28:10.756429903Z","notes":[{"timestamp":"2026-01-31T21:28:08.516192437Z","author":"patrick","message":"Refactoring completed successfully.\n\nChanges made:\n1. Added 3 new helper functions:\n   - isJSONRequest() - Checks if request Content-Type is JSON\n   - decodeRequest() - Generic decoder for JSON or form data\n   - writeJSON() - Standardized JSON response encoding\n\n2. Refactored 8 entity CRUD handlers to use helpers:\n   - HandleBeanCreate, HandleBeanUpdate\n   - HandleRoasterCreate, HandleRoasterUpdate\n   - HandleGrinderCreate, HandleGrinderUpdate\n   - HandleBrewerCreate, HandleBrewerUpdate\n\nResults:\n- Reduced file from 2239 to 2185 lines (54 lines removed)\n- Eliminated duplication of Content-Type parsing logic (8 occurrences)\n- Eliminated duplication of form parsing logic (8 occurrences)\n- Eliminated duplication of JSON encoding logic (8 occurrences)\n- All handlers now follow consistent patterns\n- All tests pass (15 test cases, 100% pass rate)\n- Code successfully compiles\n\nPattern established:\nEach handler now follows a clean, consistent flow:\n1. Authenticate via getAtprotoStore()\n2. Decode via decodeRequest() helper\n3. Validate request\n4. Execute store operation\n5. Encode response via writeJSON() helper\n\nThe refactoring makes it much easier to add new entity types in the future by following the established pattern."}]}
{"id":"01KGAYXR0JP80F5KCQG26VHF5B","title":"Remove deprecated modal component files","description":"Several modal component files are marked as deprecated and should be removed:\n\n**Files to remove:**\n1. internal/web/components/modal.templ\n   - Contains Alpine.js x-show based Modal components\n   - Comment: 'This file is kept only for backwards compatibility and will be removed in a future cleanup'\n\n2. internal/web/components/modal_templ.go (generated)\n\n3. internal/web/components/entity_modals.templ\n   - Contains deprecated Alpine.js modals for Bean, Grinder, Brewer, Roaster\n   - Superseded by dialog_modals.templ using native HTML5 \u003cdialog\u003e\n\n4. internal/web/components/entity_modals_templ.go (generated)\n\n**Also update:**\n- internal/web/pages/components_test.go has test 'Modal with static title' that tests deprecated component\n\n**Current replacement:**\n- dialog_modals.templ uses native HTML5 \u003cdialog\u003e elements\n\nAcceptance criteria:\n- Remove all deprecated modal files\n- Update or remove any tests using deprecated components\n- Verify no imports reference removed files\n- App still functions correctly","status":"completed","priority":"normal","created_at":"2026-01-31T21:21:42.418646862Z","updated_at":"2026-01-31T21:26:34.970210414Z","completed_at":"2026-01-31T21:26:34.955317746Z","notes":[{"timestamp":"2026-01-31T21:26:34.938735417Z","author":"patrick","message":"All deprecated modal component files have been successfully removed:\n\nFiles removed:\n- internal/web/components/modal.templ\n- internal/web/components/modal_templ.go\n- internal/web/components/entity_modals.templ\n- internal/web/components/entity_modals_templ.go\n\nTest updates:\n- Removed TestModalComponents from internal/web/pages/components_test.go\n\nVerification:\n- No code references to removed components remain\n- All web page tests pass\n- The app uses dialog_modals.templ for all modal functionality"}]}
{"id":"01KGAYXR359TWZPS2AJF9ZB4S5","title":"Extract profile data fetching into reusable function","description":"Two handlers contain nearly identical ~100-line blocks for fetching user profile data:\n\n**Duplicated in:**\n1. HandleProfile (lines 1628-1733)\n2. HandleProfilePartial (lines 1875-1980)\n\nBoth do:\n- Create errgroup context\n- Fetch beans, roasters, grinders, brewers, brews in parallel\n- Parse records and build lookup maps\n- Resolve references between entities\n\n**Proposed refactoring:**\nExtract into a single helper function:\n\nfunc (h *Handler) fetchUserData(ctx context.Context, did string, publicClient *atproto.PublicClient) (*UserDataBundle, error)\n\nThis function would return a struct containing:\n- Beans (with roasters resolved)\n- Roasters\n- Grinders\n- Brewers\n- Brews (with all refs resolved)\n\nAcceptance criteria:\n- Create fetchUserData helper function\n- Refactor both handlers to use it\n- Reduce duplicated code by ~80-100 lines\n- All profile functionality works as before","status":"completed","priority":"low","created_at":"2026-01-31T21:21:42.501437644Z","updated_at":"2026-01-31T21:32:30.483213969Z","completed_at":"2026-01-31T21:32:30.468389045Z"}
{"id":"01KGB1KDNNZZ7ZDA5NCK0T4E1G","title":"Create shared entity table components for profile and manage pages","description":"## Summary\nRefactor the profile and manage page tables to use shared components, reducing duplication and improving maintainability.\n\n## Current State\n- `manage_partial.templ` has tables for beans, roasters, grinders, brewers with Edit/Delete actions\n- `profile_partial.templ` has similar tables but without actions\n- Beans on profile are split into \"Open Bags\" and \"Closed Bags\" sections\n- Significant HTML/structure duplication between the two files\n\n## Proposed Solution\nCreate shared table components with configurable props:\n\n### Shared Components to Create\n1. **BeansTable** - shared beans table component\n2. **RoastersTable** - shared roasters table component  \n3. **GrindersTable** - shared grinders table component\n4. **BrewersTable** - shared brewers table component\n\n### Props Pattern\nEach component should accept props that control behavior:\n\n```go\ntype EntityTableProps struct {\n    Items        []*models.Entity\n    ShowActions  bool              // Whether to render Edit/Delete column\n    // Other entity-specific options as needed\n}\n```\n\n### Beans Table Special Handling\nThe beans table has unique requirements:\n- Manage page: single table with Status column, shows all beans\n- Profile page: split into Open/Closed sections, no Status column\n\nOptions to handle this:\n1. **Single component with `ShowStatus` prop** - manage uses it, profile calls it twice with filtered lists\n2. **`GroupByStatus` prop** - component internally groups and renders sections\n3. Keep beans separate if complexity doesn't warrant sharing\n\nRecommend option 1 - simpler, profile already filters beans via `filterOpenBeans`/`filterClosedBeans`.\n\n### Actions Implementation\nWhen `ShowActions: true`:\n- Render action column header\n- Render Edit button with `hx-get=\"/api/modals/{entity}/{rkey}\"`\n- Render Delete button with `hx-delete=\"/api/{entities}/{rkey}\"`\n\n### Files to Modify\n- `internal/web/components/manage_partial.templ` - use shared components\n- `internal/web/components/profile_partial.templ` - use shared components\n- `internal/web/components/entity_tables.templ` (new) - shared table components\n\n### Acceptance Criteria\n- [ ] Shared table components created in `entity_tables.templ`\n- [ ] `manage_partial.templ` refactored to use shared components\n- [ ] `profile_partial.templ` refactored to use shared components\n- [ ] Actions can be enabled/disabled via props\n- [ ] No visual regressions on manage page\n- [ ] No visual regressions on profile page\n- [ ] `templ generate` runs successfully\n- [ ] Tests pass (if any)","status":"completed","priority":"normal","assignee":"patrick","labels":["frontend","refactoring"],"created_at":"2026-01-31T22:08:29.877786981Z","updated_at":"2026-01-31T22:16:42.669635082Z","completed_at":"2026-01-31T22:16:42.657711384Z"}
{"id":"01KGB2WBMP539SFSKZCKJAYH0C","title":"Prevent line wrap between emoji and text in table headers","description":"Add whitespace-nowrap to table header cells to prevent the emoji and column name from wrapping onto separate lines.","status":"completed","priority":"normal","assignee":"patrick","labels":["frontend"],"created_at":"2026-01-31T22:30:51.286845962Z","updated_at":"2026-01-31T22:31:23.380048647Z","completed_at":"2026-01-31T22:31:23.369060496Z"}
{"id":"01KGBF5Q2KJ8PZNSMJPFFF31C8","title":"Add AT Protocol explanation page","description":"Create a page explaining what the AT Protocol is that the footer link redirects to instead of atproto.com.\n\nAcceptance criteria:\n- New /atproto page explaining the AT Protocol\n- Footer AT Protocol link redirects to /atproto instead of external site\n- Page matches site design system\n- Explains what AT Protocol is and how Arabica uses it\n- Links to atproto.com for those who want more info","status":"claimed","priority":"normal","assignee":"patrick","created_at":"2026-02-01T02:05:40.819263564Z","updated_at":"2026-02-01T02:10:19.29363426Z","notes":[{"timestamp":"2026-02-01T02:10:19.279321594Z","author":"patrick","message":"Initial implementation complete:\n- Created /atproto page with AT Protocol explanation\n- Updated footer link to point to /atproto instead of external site\n- Added route and handler\n- Page covers: PDS, DIDs, Lexicons, AT-URIs, how Arabica uses ATProto\n- Includes links to atproto.com for more info\nReady for review and final polish"}]}
{"id":"01KGBM1YCGZRNTVCJDZFV3100R","title":"Move web/static to static directory","description":"Move web/static directory to top-level static directory and update all references across the codebase.\n\nFiles to update:\n- flake.nix (tailwindcss paths)\n- .gitignore (output.css path)\n- justfile (tailwindcss paths)\n- default.nix (tailwindcss paths)\n- .gitattributes (vendored JS paths)\n- internal/routing/routing.go (file server path)\n- deploy/Dockerfile (COPY command)\n- CLAUDE.md (documentation)\n\nAcceptance criteria:\n- web/static moved to static/\n- All references updated\n- Server still serves static files correctly\n- Tailwind CSS build still works","status":"completed","priority":"normal","assignee":"patrick","created_at":"2026-02-01T03:31:00.112467261Z","updated_at":"2026-02-01T03:32:59.754877212Z","completed_at":"2026-02-01T03:32:59.739794374Z"}
{"id":"01KGDXVE566WVDG8TC9DWPSYXF","title":"Implement likes for social interactions","description":"Add a like lexicon and implement like functionality across the app.\n\n## Lexicon: social.arabica.alpha.like\n\nThe like record should:\n- Use `com.atproto.repo.strongRef` for the subject (URI + CID for immutability)\n- Support liking any arabica.social lexicon type (beans, roasters, grinders, brewers, brews, and comments once implemented)\n- Include createdAt timestamp\n- Use TID as record key\n\n## Backend Implementation\n\n1. Create lexicon file: `lexicons/social.arabica.alpha.like.json`\n2. Add NSID constant in `internal/atproto/nsid.go`\n3. Add Like model in `internal/models/models.go`\n4. Add record conversion functions in `internal/atproto/records.go`\n5. Add Store interface methods: CreateLike, DeleteLike, GetLikesForSubject, GetUserLikes\n6. Implement in AtprotoStore\n7. Update firehose indexing to track likes\n\n## Frontend Implementation\n\n1. Add like button component\n2. Show like counts on brews/beans/etc in feed\n3. Update like counts in response to firehose events (real-time updates)\n4. Toggle like state based on current user's likes\n\n## Acceptance Criteria\n\n- Users can like any arabica.social record\n- Likes are stored in the user's PDS (actor-owned data)\n- Like counts display on records in the feed\n- Real-time like count updates via firehose\n- Optimistic UI updates for likes","status":"open","priority":"high","labels":["backend","frontend","atproto"],"created_at":"2026-02-02T01:00:41.510646368Z","updated_at":"2026-02-02T01:00:41.510646368Z"}
{"id":"01KGDXVR86CB2H44DJHKN4Z9M0","title":"Implement comments for social interactions","description":"Add a comment lexicon and implement comment functionality across the app.\n\n## Lexicon: social.arabica.alpha.comment\n\nThe comment record should:\n- Use `com.atproto.repo.strongRef` for the subject (URI + CID for immutability)\n- Support commenting on any arabica.social lexicon type (beans, roasters, grinders, brewers, brews, and other comments)\n- Include text field (max 1000 chars / 300 graphemes as per AT Protocol conventions)\n- Include createdAt timestamp\n- Use TID as record key\n- NOTE: This cell implements flat comments only. Threaded/nested comments are handled in a separate cell.\n\n## Backend Implementation\n\n1. Create lexicon file: `lexicons/social.arabica.alpha.comment.json`\n2. Add NSID constant in `internal/atproto/nsid.go`\n3. Add Comment model in `internal/models/models.go`\n4. Add record conversion functions in `internal/atproto/records.go`\n5. Add Store interface methods: CreateComment, DeleteComment, GetCommentsForSubject, GetUserComments\n6. Implement in AtprotoStore\n7. Update firehose indexing to track comments\n\n## Frontend Implementation\n\n1. Add comment section component below brew detail view\n2. Add comment form (authenticated users only)\n3. Display comment count on records in feed\n4. Update comment counts in response to firehose events\n5. Show commenter profile info (avatar, handle)\n\n## Acceptance Criteria\n\n- Users can comment on any arabica.social record\n- Comments are stored in the user's PDS (actor-owned data)\n- Comment counts display on records in the feed\n- Comments visible on record detail views\n- Real-time comment count updates via firehose","status":"open","priority":"normal","labels":["backend","frontend","atproto"],"created_at":"2026-02-02T01:00:51.846427126Z","updated_at":"2026-02-02T01:00:51.846427126Z"}
{"id":"01KGDXW31PHFMBE3WTV83HPET1","title":"Implement comment threading","description":"Add support for threaded/nested comments, building on the flat comment system.\n\n## Lexicon Changes\n\nUpdate `social.arabica.alpha.comment` to add optional threading fields:\n- `parent`: Optional strongRef to parent comment (for replies)\n- `root`: Optional strongRef to root subject (maintains context when replying to comments)\n\nAlternatively, consider a separate reply field or keeping comments flat with UI-level threading.\n\n## Backend Implementation\n\n1. Update comment model to include parent/root references\n2. Add methods to fetch comment threads: GetCommentThread, GetReplies\n3. Update firehose indexing to track parent-child relationships\n4. Add depth limits for threading (prevent infinite nesting)\n\n## Frontend Implementation\n\n1. Design threaded comment UI (indentation, collapse/expand)\n2. Add 'reply' button on comments\n3. Show reply context when replying\n4. Consider max nesting depth for display (e.g., 3-4 levels)\n5. Mobile-friendly thread navigation\n\n## Design Considerations\n\n- How deep should threading go? (Recommend max 3-4 levels visible, then flatten)\n- How to handle deleted parent comments?\n- Should users be notified when someone replies to their comment?\n- Performance: lazy-load deep threads vs eager-load\n\n## Acceptance Criteria\n\n- Users can reply directly to comments\n- Thread structure is visually clear\n- Threads can be collapsed/expanded\n- Works well on mobile devices\n- Parent context shown when replying","status":"blocked","priority":"low","blocked_by":["01KGDXVR86CB2H44DJHKN4Z9M0"],"labels":["frontend","atproto"],"created_at":"2026-02-02T01:01:02.902692829Z","updated_at":"2026-02-02T01:01:06.361891137Z"}
{"id":"01KGGG8EHG9Y6VQ8PZM9W74584","title":"Refactor lexicon record types to use concrete RecordType","description":"Replace magic strings for lexicon record types with a concrete RecordType type and defined constants.\n\n## Current State\nMagic strings like \"brew\", \"bean\", \"roaster\", \"grinder\", \"brewer\" are used throughout the codebase:\n- `internal/feed/service.go` - FeedItem.RecordType field uses string type\n- `internal/firehose/index.go` - Sets RecordType to string literals\n- `internal/web/pages/feed.templ` - Switch cases on string values\n- `internal/handlers/handlers.go` - writeJSON calls with string type names\n\n## Proposed Changes\n1. Define a `RecordType` type in `internal/atproto/nsid.go` (or a new file)\n2. Create constants: `RecordTypeBrew`, `RecordTypeBean`, `RecordTypeRoaster`, `RecordTypeGrinder`, `RecordTypeBrewer`, `RecordTypeLike`\n3. Update `FeedItem.RecordType` in `feed/service.go` to use the new type\n4. Update all string literal usages to use the constants\n5. Consider adding helper methods (e.g., `RecordType.String()`, `RecordType.DisplayName()`)\n\n## Acceptance Criteria\n- No magic strings for record types remain in Go code\n- Template switch statements updated to use constants\n- Type safety enforced at compile time\n- All tests pass","status":"completed","priority":"normal","labels":["refactoring","tech-debt"],"created_at":"2026-02-03T01:00:51.120049807Z","updated_at":"2026-02-03T01:06:55.448414863Z","completed_at":"2026-02-03T01:06:55.435337779Z"}
{"id":"01KGGHX6R13BR2S5K4WZM79F6K","title":"Design profile brews with social features","description":"## Problem\n\nThe profile page currently displays brews in a table format, but we need to add likes and shares which don't fit ergonomically into table columns. Additionally, the table design doesn't work well on mobile.\n\n## Options to Evaluate\n\n### Option A: Add columns to existing table\n- Add Like count and Share button columns\n- Pros: Minimal change, consistent with current design\n- Cons: Tables already cramped, poor mobile experience, doesn't match feed UX\n\n### Option B: Convert brews to card-based layout (like feed)\n- Reuse/adapt FeedBrewContent component for profile brews\n- Keep tables for equipment/beans (less social, more data-dense)\n- Pros: Better mobile experience, natural fit for social buttons, consistent with feed\n- Cons: More work, different UX between profile and brew list\n\n### Option C: Hybrid responsive approach\n- Cards on mobile, table on desktop\n- Pros: Best of both worlds\n- Cons: More complexity, two layouts to maintain\n\n## Acceptance Criteria\n\n1. Research complete: Document the chosen approach with rationale\n2. Design spec: Mockup or clear description of the new layout\n3. If cards: Define how profile brew cards differ from feed cards (actions, ownership indicators)\n4. Consider: Should beans/equipment also get social features eventually?\n\n## Implementation Subtasks (create as separate cells)\n\nAfter design is approved:\n- [ ] Create ProfileBrewCard component (if card approach)\n- [ ] Update profile brews tab to use new layout  \n- [ ] Add like count display to brew entries\n- [ ] Add share button to brew entries\n- [ ] Mobile responsiveness testing\n- [ ] Update any related styles in app.css\n\n## Notes\n\n- Social buttons already exist in components/social_buttons.templ\n- Feed cards provide a good reference: pages/feed.templ\n- Current brew table: components/brew_list_table.templ\n- Profile page: pages/profile.templ","status":"completed","priority":"high","assignee":"patrick","labels":["frontend","design","ux"],"created_at":"2026-02-03T01:29:39.841071728Z","updated_at":"2026-02-03T01:40:12.593195795Z","completed_at":"2026-02-03T01:40:12.57909568Z","notes":[{"timestamp":"2026-02-03T01:39:17.359358581Z","author":"patrick","message":"## Final Design Approved\n\n### Card Structure\n- Reuse feed cards as-is with author header (username/avatar)\n- Content area clickable → navigates to /brews/{id}\n- New action bar below content (outside record div)\n\n### Action Bar Order\n[💬 Comments] [♡ Like] [↗ Share] [⋯ More]\n\n- Comments: placeholder/disabled for future\n- Like/Share: moved from top-right to action bar\n- More menu (shows for ALL users):\n  - Edit (owner only)\n  - Delete (owner only)  \n  - Report (all users - placeholder endpoint + TODO)"}]}
{"id":"01KGGJF66PJV9SSKCTGJP4ETWP","title":"Create ActionBar component for feed/profile cards","description":"## Task\n\nCreate a new ActionBar component for use below feed card content.\n\n## Component: ActionBar\n\n**Location:** `internal/web/components/action_bar.templ`\n\n**Props:**\n- SubjectURI string - AT-URI of the record\n- SubjectCID string - CID for strong reference\n- IsLiked bool - current user liked state\n- LikeCount int - number of likes\n- IsOwner bool - whether current user owns this record\n- ViewURL string - URL for the detail view (card click)\n- EditURL string - URL for edit action (owner only)\n- DeleteURL string - URL/handler for delete (owner only)\n- IsAuthenticated bool - whether user is logged in\n\n**Layout:**\n`[💬 Comments] [♡ Like] [↗ Share] [⋯ More]`\n\n- Comments: disabled placeholder icon + '0' count\n- Like: reuse existing like button logic (HTMX toggle)\n- Share: reuse existing share button logic\n- More: Alpine.js dropdown menu with Edit/Delete/Report\n\n**Styling:**\n- Horizontal flex row with gap\n- Icons with counts where applicable\n- More menu as dropdown positioned bottom-right\n\n## Acceptance Criteria\n- [ ] ActionBar component created with all props\n- [ ] Comments placeholder (disabled, shows 0)\n- [ ] Like button functional (HTMX toggle)\n- [ ] Share button functional (Web Share API)\n- [ ] More dropdown with Edit/Delete (owner) and Report (all)\n- [ ] templ generate runs successfully","status":"completed","priority":"high","assignee":"patrick","labels":["frontend","component"],"created_at":"2026-02-03T01:39:29.110143411Z","updated_at":"2026-02-03T01:43:15.859354984Z","completed_at":"2026-02-03T01:43:15.845204627Z"}
{"id":"01KGGJFDK0S6VBVY51HJWDS6CF","title":"Update feed cards to use ActionBar","description":"## Task\n\nUpdate the feed page to use the new ActionBar component instead of inline social buttons.\n\n## Changes to feed.templ\n\n1. Remove social buttons from author row (top-right)\n2. Make content area clickable (link to /brews/{rkey} or appropriate detail URL)\n3. Add ActionBar below the content div\n4. Pass appropriate props (SubjectURI, SubjectCID, like state, ownership, URLs)\n\n## Card Click Behavior\n\n- Wrap .feed-content-box in an anchor tag\n- Link to brew detail: /brews/{rkey}\n- For other record types (beans, equipment): link to appropriate manage section or skip\n\n## Acceptance Criteria\n- [ ] Social buttons removed from author row\n- [ ] Content area clickable for brews\n- [ ] ActionBar rendered below content\n- [ ] Like/Share still functional via ActionBar\n- [ ] More menu shows Edit/Delete for owner, Report for all\n- [ ] templ generate runs successfully\n- [ ] Visual regression check on feed page","status":"completed","priority":"high","assignee":"patrick","labels":["frontend"],"created_at":"2026-02-03T01:39:36.672372228Z","updated_at":"2026-02-03T01:44:45.86254562Z","completed_at":"2026-02-03T01:44:45.851397847Z"}
{"id":"01KGGJFSZ4YDNF6ZE8F9WRT79F","title":"Replace profile brew table with cards","description":"## Task\n\nReplace the table-based brew list on the profile page with card-based layout matching the feed.\n\n## Changes\n\n### profile.templ / profile_partial.templ\n1. Replace BrewListTablePartial with card-based layout\n2. Reuse FeedItem/FeedBrewContent components or create ProfileBrewCard\n3. Include ActionBar with owner actions enabled\n4. Maintain grid/list layout for multiple brews\n\n### Layout Considerations\n- Cards should stack vertically (like feed)\n- Consider max-width for readability\n- Mobile: single column\n- Desktop: could be single column or 2-column grid\n\n### Props to Pass\n- Full brew data\n- Bean/roaster/grinder/brewer references\n- IsOwner: true (it's the user's profile)\n- Like/share state for each brew\n\n## Acceptance Criteria\n- [ ] Brew table replaced with cards on profile\n- [ ] Cards show all brew info (bean, method, variables, notes, rating)\n- [ ] ActionBar with Edit/Delete functional for owner\n- [ ] Cards link to brew detail view\n- [ ] Mobile responsive\n- [ ] templ generate runs successfully","status":"completed","priority":"high","assignee":"patrick","labels":["frontend"],"created_at":"2026-02-03T01:39:49.348915829Z","updated_at":"2026-02-03T01:49:13.11140332Z","completed_at":"2026-02-03T01:49:13.098282125Z"}
{"id":"01KGGJG2FDK2NN8H059PTHNME0","title":"Add placeholder report endpoint","description":"## Task\n\nAdd a placeholder report endpoint for the More menu Report action.\n\n## Endpoint\n\n**Route:** POST /api/report\n**Handler:** HandleReport\n\n## Request Body\n```json\n{\n  \"subject_uri\": \"at://did:plc:xxx/social.arabica.alpha.brew/rkey\",\n  \"subject_cid\": \"bafyrei...\",\n  \"reason\": \"spam|inappropriate|other\"\n}\n```\n\n## Response\n- 200 OK with `{\"status\": \"received\"}`\n- Log the report for now\n- TODO comment indicating future implementation needs\n\n## Implementation Notes\n- Add route to routing.go\n- Create minimal handler that logs and returns success\n- No actual moderation system yet - just capture the intent\n\n## Acceptance Criteria\n- [ ] POST /api/report endpoint exists\n- [ ] Accepts subject_uri, subject_cid, reason\n- [ ] Logs report details\n- [ ] Returns success response\n- [ ] TODO comment for future moderation system","status":"completed","priority":"normal","assignee":"patrick","labels":["backend","api"],"created_at":"2026-02-03T01:39:58.061904095Z","updated_at":"2026-02-03T01:43:12.681518812Z","completed_at":"2026-02-03T01:43:12.667221097Z"}
{"id":"01KGGK6V4WMC3X67E72JTE27A7","title":"Fix 'failed to convert record to feed item' warning for likes","description":"The firehose index logs a warning 'failed to convert record to feed item' when processing like records. This is expected behavior since likes are not displayed as standalone feed items - they're indexed for like counts but shouldn't appear in the feed.\n\nThe warning appears in internal/firehose/index.go:433 when recordToFeedItem returns an error for NSIDLike records (line 582-584).\n\nFix: Handle the like case silently without logging a warning, since this is expected behavior. Either:\n1. Skip like records before calling recordToFeedItem\n2. Return a special sentinel error from recordToFeedItem that indicates 'skip without warning'\n3. Check the collection type at the call site and skip likes there\n\nThis applies to both authenticated and unauthenticated users.","status":"completed","priority":"normal","labels":["bug"],"created_at":"2026-02-03T01:52:24.220349056Z","updated_at":"2026-02-03T01:54:54.698106017Z","completed_at":"2026-02-03T01:54:54.686934901Z"}
{"id":"01KGGNPG25M2AJ619P65FPMEH4","title":"Add OpenGraph metadata to brew pages","description":"Add dynamic OpenGraph metadata support for brew pages to enable rich social sharing previews.\n\n## Background\n\nCurrently, the site uses static OpenGraph tags in layout.templ:\n- og:title: \"Arabica - Coffee Brew Tracker\" (static)\n- og:description: \"Track your coffee brewing journey...\" (static)  \n- og:type: \"website\" (static)\n- og:image: NOT PRESENT\n\nWhen users share brew links on social media, all previews look identical and provide no context about the specific brew.\n\n## Requirements\n\n### 1. Extend LayoutData struct\n\nAdd optional OpenGraph fields to `internal/web/components/layout.templ`:\n\n```go\ntype LayoutData struct {\n    Title           string\n    IsAuthenticated bool\n    UserDID         string\n    UserProfile     *bff.UserProfile\n    CSPNonce        string\n    \n    // OpenGraph metadata (optional, falls back to defaults)\n    OGTitle       string\n    OGDescription string\n    OGImage       string\n    OGType        string // \"website\", \"article\"\n    OGUrl         string // Canonical URL\n}\n```\n\n### 2. Update layout.templ head section\n\nModify meta tag rendering to use dynamic values with fallbacks:\n- If OGTitle set, use it; otherwise use site default\n- If OGDescription set, use it; otherwise use site default\n- If OGImage set, render og:image tag (currently missing entirely)\n- If OGUrl set, render og:url tag\n- Support og:type (default \"website\", brew pages use \"article\")\n\n### 3. Update buildLayoutData helper\n\nExtend `handlers.go` buildLayoutData() to accept optional OG parameters, or create a new helper `buildLayoutDataWithOG()`.\n\n### 4. Update HandleBrewView handler\n\nConstruct descriptive OG metadata from brew data:\n- **og:title**: \"{Bean Name} from {Origin} - Arabica\" or similar\n- **og:description**: \"{Rating}/10 - {Tasting Notes preview}\" or brew summary\n- **og:type**: \"article\"\n- **og:url**: The share URL (already computed as `shareURL`)\n- **og:image**: Static default for now (e.g., /static/og-brew-default.png)\n\nAvailable data for description construction:\n- brew.Rating, brew.TastingNotes\n- brew.Bean.Name, brew.Bean.Origin, brew.Bean.RoastLevel\n- brew.Bean.Roaster.Name\n- brew.CoffeeAmount, brew.WaterAmount, brew.Temperature\n\n### 5. Add Twitter Card support\n\nAdd Twitter-specific meta tags:\n- twitter:card = \"summary\" (or \"summary_large_image\" if we have images)\n- twitter:title, twitter:description (same as OG values)\n\n### 6. Static fallback image\n\nCreate or source a default OG image for brews:\n- Location: /static/og-brew-default.png or similar\n- Size: 1200x630px (recommended OG image size)\n- Design: Coffee-themed, includes Arabica branding\n\n## Acceptance Criteria\n\n- [ ] LayoutData extended with optional OG fields\n- [ ] layout.templ renders dynamic OG tags with fallbacks\n- [ ] Brew view pages include descriptive OG metadata\n- [ ] Twitter Card tags included\n- [ ] Static default OG image created and served\n- [ ] Existing pages (home, about, etc.) continue working with defaults\n- [ ] templ generate runs successfully\n- [ ] Manual testing: share brew URL to social platform preview tool\n\n## Implementation Notes\n\n- Follow existing patterns in handlers.go for data flow\n- Keep backwards compatible - pages not setting OG fields should use defaults\n- Consider creating a helper function to build OG description from brew data\n- The shareURL is already constructed in HandleBrewView (lines 695-701)\n\n## Future Enhancements (out of scope)\n\n- Dynamic image generation showing brew stats\n- Profile page OG metadata\n- Feed page OG metadata with recent brew preview","status":"completed","priority":"normal","assignee":"patrick","labels":["frontend","social"],"created_at":"2026-02-03T02:35:54.309356038Z","updated_at":"2026-02-03T02:53:43.170537883Z","completed_at":"2026-02-03T02:53:43.15817599Z","notes":[{"timestamp":"2026-02-03T02:53:36.100130152Z","author":"patrick","message":"Implementation complete:\n- Extended LayoutData with OG fields (OGTitle, OGDescription, OGImage, OGType, OGUrl)\n- Added helper methods ogTitle(), ogDescription(), ogType() with fallbacks\n- Updated layout.templ to render dynamic OG and Twitter Card meta tags\n- Added populateBrewOGMetadata() helper in handlers.go\n- Updated HandleBrewView to populate OG metadata from brew data\n- Added PublicURL to handler Config for absolute URLs\n- Added comprehensive tests for OG metadata generation\n- All tests pass"}]}
{"id":"01KGK913NFHX2MMAXHCXT5S8HM","title":"Implement moderation service core with role-based permissions","description":"Create the core moderation service with JSON-based role configuration.\n\n## Requirements\n\n### JSON Config File (config/moderators.json)\n```json\n{\n  \"roles\": {\n    \"admin\": {\n      \"description\": \"Full platform control\",\n      \"permissions\": [\"hide_record\", \"unhide_record\", \"blacklist_user\", \"unblacklist_user\", \"view_reports\", \"dismiss_report\", \"view_audit_log\"]\n    },\n    \"moderator\": {\n      \"description\": \"Content moderation\",\n      \"permissions\": [\"hide_record\", \"unhide_record\", \"view_reports\", \"dismiss_report\"]\n    }\n  },\n  \"users\": [\n    {\"did\": \"did:plc:xxx\", \"handle\": \"arabica.social\", \"role\": \"admin\", \"note\": \"Platform owner\"}\n  ]\n}\n```\n\n### ModerationService (internal/moderation/service.go)\n- Load config from JSON file (path from env var or flag)\n- `IsAdmin(did string) bool`\n- `IsModerator(did string) bool` (includes admins)\n- `HasPermission(did string, permission string) bool`\n- `GetRole(did string) (Role, bool)`\n- `ListModerators() []ModeratorUser`\n\n### Models (internal/moderation/models.go)\n- Role struct with permissions\n- ModeratorUser struct\n- Config struct\n\nAcceptance criteria:\n- Config file is validated on load (unknown roles, missing required fields)\n- Service is nil-safe (returns false/empty if not configured)\n- Reload capability for config changes without restart (nice to have)\n- Unit tests for permission checking","status":"completed","priority":"high","assignee":"patrick","labels":["moderation","backend"],"created_at":"2026-02-04T02:52:13.871235963Z","updated_at":"2026-02-04T03:07:38.338966523Z","completed_at":"2026-02-04T03:07:38.323669324Z","notes":[{"timestamp":"2026-02-04T03:07:38.24039103Z","author":"patrick","message":"Implemented core moderation service:\n- Created internal/moderation/models.go with Role, Permission, ModeratorUser, and Config types\n- Created internal/moderation/service.go with role-based permission checking\n- Added 17 unit tests covering all functionality\n- Created config/moderators.json.example with example configuration\n- Updated CLAUDE.md with new env var ARABICA_MODERATORS_CONFIG and project structure"}]}
{"id":"01KGK913QKZ96RKRH37VB99C7D","title":"Implement moderation storage in BoltDB","description":"Add BoltDB buckets and operations for moderation data.\n\n## Storage Requirements\n\n### Buckets\n- `moderation_hidden_records` - AT-URIs of hidden records\n- `moderation_blacklisted_users` - Blacklisted DIDs with metadata\n- `moderation_reports` - User reports on content\n- `moderation_audit_log` - All moderation actions\n\n### Models (internal/moderation/models.go additions)\n\n```go\ntype HiddenRecord struct {\n    ATURI       string    `json:\"at_uri\"`\n    HiddenAt    time.Time `json:\"hidden_at\"`\n    HiddenBy    string    `json:\"hidden_by\"`     // DID of moderator\n    Reason      string    `json:\"reason\"`\n    AutoHidden  bool      `json:\"auto_hidden\"`   // true if automod\n}\n\ntype BlacklistedUser struct {\n    DID           string    `json:\"did\"`\n    BlacklistedAt time.Time `json:\"blacklisted_at\"`\n    BlacklistedBy string    `json:\"blacklisted_by\"`\n    Reason        string    `json:\"reason\"`\n}\n\ntype Report struct {\n    ID          string    `json:\"id\"`           // TID\n    SubjectURI  string    `json:\"subject_uri\"`  // AT-URI of reported content\n    SubjectDID  string    `json:\"subject_did\"`  // DID of content owner\n    ReporterDID string    `json:\"reporter_did\"`\n    Reason      string    `json:\"reason\"`\n    CreatedAt   time.Time `json:\"created_at\"`\n    Status      string    `json:\"status\"`       // pending, dismissed, actioned\n    ResolvedBy  string    `json:\"resolved_by\"`\n    ResolvedAt  *time.Time `json:\"resolved_at\"`\n}\n\ntype AuditEntry struct {\n    ID        string    `json:\"id\"`\n    Action    string    `json:\"action\"`     // hide_record, blacklist_user, etc.\n    ActorDID  string    `json:\"actor_did\"`\n    TargetURI string    `json:\"target_uri\"` // AT-URI or DID\n    Reason    string    `json:\"reason\"`\n    Timestamp time.Time `json:\"timestamp\"`\n    AutoMod   bool      `json:\"auto_mod\"`\n}\n```\n\n### Store Interface (internal/moderation/store.go)\n```go\ntype Store interface {\n    // Hidden records\n    HideRecord(ctx context.Context, entry HiddenRecord) error\n    UnhideRecord(ctx context.Context, atURI string) error\n    IsRecordHidden(ctx context.Context, atURI string) bool\n    ListHiddenRecords(ctx context.Context) ([]HiddenRecord, error)\n    \n    // Blacklist\n    BlacklistUser(ctx context.Context, entry BlacklistedUser) error\n    UnblacklistUser(ctx context.Context, did string) error\n    IsBlacklisted(ctx context.Context, did string) bool\n    ListBlacklistedUsers(ctx context.Context) ([]BlacklistedUser, error)\n    \n    // Reports\n    CreateReport(ctx context.Context, report Report) error\n    GetReport(ctx context.Context, id string) (*Report, error)\n    ListPendingReports(ctx context.Context) ([]Report, error)\n    ResolveReport(ctx context.Context, id string, status string, resolvedBy string) error\n    CountReportsForURI(ctx context.Context, atURI string) (int, error)\n    CountReportsForDID(ctx context.Context, did string) (int, error)\n    \n    // Audit\n    LogAction(ctx context.Context, entry AuditEntry) error\n    ListAuditLog(ctx context.Context, limit int) ([]AuditEntry, error)\n}\n```\n\nAcceptance criteria:\n- All operations are atomic\n- Audit logging happens automatically on moderation actions\n- Efficient lookups for IsRecordHidden and IsBlacklisted (called on every feed item)\n- Unit tests for store operations","status":"completed","priority":"high","assignee":"patrick","labels":["moderation","backend","database"],"created_at":"2026-02-04T02:52:13.939164045Z","updated_at":"2026-02-04T03:12:29.407349995Z","completed_at":"2026-02-04T03:12:29.395926199Z","notes":[{"timestamp":"2026-02-04T03:12:29.301269019Z","author":"patrick","message":"Implemented BoltDB storage for moderation:\n- Added 6 new buckets for moderation data in store.go\n- Created moderation_store.go with full CRUD operations:\n  - Hidden records: HideRecord, UnhideRecord, IsRecordHidden, GetHiddenRecord, ListHiddenRecords\n  - Blacklist: BlacklistUser, UnblacklistUser, IsBlacklisted, GetBlacklistedUser, ListBlacklistedUsers\n  - Reports: CreateReport, GetReport, ListPendingReports, ResolveReport, CountReportsForURI/DID, HasReportedURI\n  - Audit: LogAction, ListAuditLog\n- Added indexes for efficient report counting by URI and DID\n- Created comprehensive tests (20 test cases)"}]}
{"id":"01KGK91R3NWQEPPSSK9035JFZQ","title":"Integrate moderation filtering into feed service","description":"Hook moderation service into feed aggregation to filter hidden content and blacklisted users.\n\n## Requirements\n\n### Feed Service Changes (internal/feed/service.go)\n- Accept ModerationService dependency\n- Filter out hidden records before returning feed items\n- Filter out all records from blacklisted users\n- Consider performance: batch lookups vs per-item checks\n\n### Integration Points\n```go\ntype FeedService struct {\n    // existing fields...\n    moderation *moderation.Service\n}\n\nfunc (f *FeedService) GetFeed(ctx context.Context) ([]FeedItem, error) {\n    items := f.getRawFeed(ctx)\n    return f.filterModerated(ctx, items), nil\n}\n\nfunc (f *FeedService) filterModerated(ctx context.Context, items []FeedItem) []FeedItem {\n    var filtered []FeedItem\n    for _, item := range items {\n        if f.moderation.IsBlacklisted(ctx, item.AuthorDID) {\n            continue\n        }\n        if f.moderation.IsRecordHidden(ctx, item.ATURI) {\n            continue\n        }\n        filtered = append(filtered, item)\n    }\n    return filtered\n}\n```\n\n### Public Brew View\n- Also filter on individual brew view endpoint (/brews/{did}/{rkey})\n- Return 404 for hidden records (or 451 Unavailable For Legal Reasons?)\n- Return 404 for blacklisted users' content\n\n### Handler Updates (internal/handlers/handlers.go)\n- Inject moderation service\n- Check moderation status on brew view routes\n\nAcceptance criteria:\n- Hidden records don't appear in feed\n- Blacklisted users' content doesn't appear anywhere\n- Minimal performance impact (consider caching blacklist/hidden sets)\n- Graceful degradation if moderation service unavailable","status":"open","priority":"high","labels":["moderation","backend","feed"],"created_at":"2026-02-04T02:52:34.805956493Z","updated_at":"2026-02-04T03:12:29.411028537Z"}
{"id":"01KGK91R5RCE0B0PASS301ZZQT","title":"Implement user report submission system","description":"Allow authenticated users to report content with basic automod thresholds.\n\n## Requirements\n\n### Report Endpoint\n- POST /api/reports\n- Requires authentication\n- Rate limited (max 10 reports per user per hour)\n\n### Request/Response\n```go\ntype ReportRequest struct {\n    SubjectURI string `json:\"subject_uri\"`  // AT-URI of content\n    Reason     string `json:\"reason\"`       // free text, max 500 chars\n}\n\ntype ReportResponse struct {\n    ID      string `json:\"id\"`\n    Message string `json:\"message\"`\n}\n```\n\n### Automod Thresholds\nConfigurable via JSON config or constants:\n```go\nconst (\n    AutoHideThreshold       = 3  // reports on single record\n    AutoHideUserThreshold   = 5  // total reports across user's records\n    NewUserDays            = 7   // users \u003c 7 days old\n    NewUserAutoHideThreshold = 2 // lower threshold for new users\n)\n```\n\nWhen threshold reached:\n1. Auto-hide the record (mark AutoHidden: true)\n2. Create audit log entry with AutoMod: true\n3. Keep report in pending state for moderator review\n\n### UI Component\n- Report button on brew cards in feed\n- Report button on brew detail page\n- Simple modal: textarea for reason + submit\n- Confirmation message after submission\n\n### Handler (internal/handlers/moderation.go)\n```go\nfunc (h *Handler) HandleSubmitReport(w http.ResponseWriter, r *http.Request)\n```\n\nAcceptance criteria:\n- Users can report any content (not their own)\n- Duplicate reports from same user are rejected\n- Automod triggers when thresholds reached\n- Rate limiting prevents abuse\n- Success/error feedback to user","status":"open","priority":"high","labels":["moderation","backend","frontend"],"created_at":"2026-02-04T02:52:34.872474383Z","updated_at":"2026-02-04T03:12:29.413298406Z"}
{"id":"01KGK926RAW8Q3SQHFH4KKKM3K","title":"Implement admin/moderator dashboard UI","description":"Create the admin dashboard for moderators and admins to take moderation actions.\n\n## Requirements\n\n### Routes\n- GET /admin - Dashboard (moderators + admins)\n- GET /admin/reports - Pending reports view\n- GET /admin/audit - Audit log (admins only)\n- POST /admin/hide - Hide a record\n- POST /admin/unhide - Unhide a record\n- POST /admin/blacklist - Blacklist a user (admins only)\n- POST /admin/unblacklist - Unblacklist a user (admins only)\n- POST /admin/reports/{id}/resolve - Resolve a report\n\n### Access Control\n- All /admin routes require authentication\n- Check HasPermission() for each action\n- Return 403 if insufficient permissions\n- Hide UI elements user can't access\n\n### Dashboard Page (internal/web/pages/admin.templ)\n```\n┌─────────────────────────────────────────────────────┐\n│ Moderation Dashboard                    [Your Role] │\n├─────────────────────────────────────────────────────┤\n│                                                     │\n│ Pending Reports (3)                                 │\n│ ┌─────────────────────────────────────────────────┐ │\n│ │ @user reported brew by @other                   │ │\n│ │ \"Spam content\"           [View] [Hide] [Dismiss]│ │\n│ └─────────────────────────────────────────────────┘ │\n│                                                     │\n│ Recently Hidden (auto-hidden marked)                │\n│ ┌─────────────────────────────────────────────────┐ │\n│ │ brew/abc by @user [AUTO] - 3 reports  [Unhide]  │ │\n│ └─────────────────────────────────────────────────┘ │\n│                                                     │\n│ Blacklisted Users (admin only)                      │\n│ ┌─────────────────────────────────────────────────┐ │\n│ │ @baduser - \"repeated spam\" [Unblacklist]        │ │\n│ └─────────────────────────────────────────────────┘ │\n│                                                     │\n│ [View Audit Log] (admin only)                       │\n└─────────────────────────────────────────────────────┘\n```\n\n### Components\n- AdminLayout component (reuses main layout but adds admin nav)\n- ReportCard component\n- HiddenRecordRow component\n- BlacklistedUserRow component\n- AuditLogTable component\n\n### HTMX Integration\n- Actions (hide/unhide/resolve) via HTMX POST\n- Optimistic UI updates\n- Error toast on failure\n\n### Handler (internal/handlers/admin.go)\nNew handler file for admin routes, or add to existing handlers.go\n\nAcceptance criteria:\n- Only accessible to moderators/admins\n- All actions require appropriate permissions\n- Actions create audit log entries\n- Responsive design\n- Confirmation dialogs for destructive actions (blacklist)","status":"blocked","priority":"high","blocked_by":["01KGK91R3NWQEPPSSK9035JFZQ","01KGK91R5RCE0B0PASS301ZZQT"],"labels":["moderation","frontend","backend"],"created_at":"2026-02-04T02:52:49.80269115Z","updated_at":"2026-02-04T02:53:05.397173603Z"}
{"id":"01KGMAQBRS5J9N0JHBJAAZ518Q","title":"Add moderator actions to feed item more menu","description":"Add moderation actions (hide/unhide) to the existing 'more' dropdown menu on feed items for users with appropriate permissions.\n\n## Requirements\n\n### UI Changes\n- Extend the existing 'more' menu (three dots) on feed/brew cards\n- Show moderation actions only if user has permission\n- Actions to add:\n  - 'Hide from feed' (if not hidden, requires hide_record permission)\n  - 'Unhide' (if hidden, requires unhide_record permission)\n  - Visual indicator if record is currently hidden (for mods viewing hidden content)\n\n### Backend Changes\n- Pass moderation context to feed/brew templates:\n  - `IsModerator bool`\n  - `CanHideRecord bool`\n  - `IsRecordHidden bool` (per item)\n- Add HTMX endpoints:\n  - POST /admin/hide (accepts AT-URI, returns updated menu)\n  - POST /admin/unhide (accepts AT-URI, returns updated menu)\n\n### Integration Points\n- Feed page (feed.templ) - brew cards in community feed\n- Profile page (profile.templ) - brew cards on user profiles\n- Brew view page (brew_view.templ) - single brew detail view\n\n### Behavior\n- Actions trigger HTMX POST requests\n- On success: swap the menu to show updated state\n- On error: show toast notification\n- Create audit log entry for each action\n\n### Permissions Check\n- Check ModerationService.HasPermission() before rendering actions\n- Check again server-side before executing action\n- Return 403 if permission denied\n\nAcceptance criteria:\n- Moderators see hide/unhide options in more menu\n- Regular users don't see moderation options\n- Actions work via HTMX without full page reload\n- Audit log entries created for all actions\n- Hidden records show visual indicator to moderators","status":"blocked","priority":"high","blocked_by":["01KGK91R3NWQEPPSSK9035JFZQ"],"labels":["moderation","frontend","backend"],"created_at":"2026-02-04T12:41:06.073520449Z","updated_at":"2026-02-04T12:41:11.046733279Z"}
